<?xml version="1.0" ?>
<project name="MyMon" basedir="." default="build">

    <!-- Sets the DSTAMP, TSTAMP and TODAY properties -->
    <tstamp/>

    <!-- Load our configuration -->
    <property file="config/build.properties" />
    <property file="config/project.properties" />

    <target name="prepare">
        <echo message="Hello, welcome to ${phing.project.name}!" />
        <echo message="Current environment is: ${project.env}" />
        <echo message="Current hostname is: ${hostname}" />
    </target>

    <!-- create our migration task -->
    <target name="migrate" depends="prepare" description="Database Migrations">

        <!-- load the dbdeploy task -->
        <taskdef
            name="dbdeploy"
            classname="phing.tasks.ext.dbdeploy.DbDeployTask"/>

        <!--
        these two filenames will contain the generated SQL
        to do the deploy and roll it back
        -->
        <property
            name="build.dbdeploy.deployfile"
            value="build/scripts/deploy-${DSTAMP}${TSTAMP}.sql" />
        <property
            name="build.dbdeploy.undofile"
            value="build/scripts/undo-${DSTAMP}${TSTAMP}.sql" />

        <!-- generate the deployment scripts -->
        <dbdeploy
            url="mysql:host=${db.host};dbname=${db.name}"
            userid="${db.user}"
            password="${db.pass}"
            dir="${build.dir}/build/db/deltas"
            outputfile="${build.dir}/${build.dbdeploy.deployfile}"
            undooutputfile="${build.dir}/${build.dbdeploy.undofile}" />

        <!--
        Execute the SQL
        Use mysql command line to avoid trouble with large files
        or many statements and PDO
        -->
        <!--<exec
            command="${progs.mysql} -h${db.host} -u${db.user} -p${db.pass} ${db.name} < ${build.dbdeploy.deployfile}"
            dir="${build.dir}"
            checkreturn="true" /> -->
    </target>
</project>